<html>
	<head>
		<meta charset="utf-8">
		<title>Backbone Test</title>
	</head>
	<body>		
		<script type="text/javascript" src="lib/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="lib/underscore-min.js"></script>
		<script type="text/javascript" src="lib/backbone-min.js"></script>
		<script type="text/javascript" src="lib/highcharts.js"></script>
		<link href="css/magicsuggest-min.css" rel="stylesheet">
		<script src="lib/magicsuggest-min.js"></script>
		<script type="text/javascript">
		var CPU=Backbone.Model.extend({
			defaults:{
				cpulist:[],
				cpuId:""
			},
			initialize:function () {
				this.cpulist=[];
				this.cpuId="";
			}
		})

		var Node=Backbone.Model.extend({
			initialize:function () {
				this.name="";
				this.data=[];
			}
		})

		var CPUList=Backbone.Collection.extend({
			model:CPU,
			url:'/demo/rest/cpu',
			initialize:function(){
			}
		})

		var CPUView=Backbone.View.extend({
			el:$('body'),
			events:{
				'click button':'fetchCPU'
			},
			initialize:function () {
				_.bindAll(this,'render','fetchCPU')
				this.collection=new CPUList();
				this.collection.on('update',this.render);
				// this.collection.fetch({reset: true});
				this.collection.fetch();
			},
			render:function () {
				var series=new Array();
				_.each(this.collection.models,function(cpu) {
					var node=new Node();
					node.name=cpu.get('cpuId');
					node.data=cpu.get('cpulist');
					series.push(node);
				})

				$("div",this.el).highcharts({
					series: series
				})
			},
			fetchCPU:function () {
				this.collection.fetch()
				.done(function (collection) {
					_.each(collection,function (cpu){
						console.log(cpu.cpulist);
					});
				});
			}
		})

		$(function () {
			var view=new CPUView();
			$('#magicsuggest').magicSuggest({
  			allowFreeEntries: false,
  			// maxSelection:1,
  			data: ['Paris', 'New York', 'Gotham']
		});
		})

		</script>
		<button>fetch</button>
		<div id="chart"></div>
		<div id="magicsuggest"></div>
	</body>
</html>